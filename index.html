<!DOCTYPE html>
<html>
    <head>
       <script src="jspsych-6.3.1/jspsych.js"></script> 
       <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
       <script src="jspsych-6.3.1/plugins/jspsych-html-button-response-catact.js"></script>
       <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
       <link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css">
       <link rel="stylesheet" href="jspsych-6.3.1/css/catAct.css">
    </head>
    <body>
    </body>
        
    <script>

        // create timeline
        var timeline = [];

        // create empty arrays - randomized array for sampling phase, randomized array for test phase
        var shuffled_sample_array = [];
        var shuffled_grid_array = [];

        // create default image size
        var grid_image_width = 150;
        var grid_image_height = 150;

        // store names of test phase image files
        var grid_image_names = ["stims/animals/subordinate/grid/temp_c3_sub6.png", "stims/animals/subordinate/grid/c3_sub7.jpg", "stims/animals/basic/grid/c3_bas4.jpg", "stims/animals/basic/grid/c3_bas3.jpg", "stims/animals/superordinate/grid/c3_sup4.jpg", "stims/animals/superordinate/grid/c3_sup3.jpg", "stims/animals/superordinate/grid/c3_sup5.jpg", "stims/animals/superordinate/grid/c3_sup6.jpg",
        "stims/vegetables/subordinate/grid/temp_c1_sub6.png", "stims/vegetables/subordinate/grid/temp_c1_sub7.png", "stims/vegetables/basic/grid/c1_bas3.jpg", "stims/vegetables/basic/grid/c1_bas4.jpg", "stims/vegetables/superordinate/grid/c1_sup2.jpg", "stims/vegetables/superordinate/grid/c1_sup3.jpg", "stims/vegetables/superordinate/grid/c1_sup4.jpg", "stims/vegetables/superordinate/grid/c1_sup5.jpg",
        "stims/vehicles/subordinate/grid/c2_sub6.jpg", "stims/vehicles/subordinate/grid/temp_c2_sub7.png", "stims/vehicles/basic/grid/c2_bas2.jpg", "stims/vehicles/basic/grid/c2_bas4.jpg", "stims/vehicles/superordinate/grid/c2_sup2.jpg", "stims/vehicles/superordinate/grid/c2_sup4.jpg", "stims/vehicles/superordinate/grid/c2_sup5.jpg", "stims/vehicles/superordinate/grid/c2_sup6.jpg"];

        // store names of sampling phase image files
        var sampling_image_names = ["stims/animals/subordinate/grid/c3_sub7.jpg", "stims/animals/basic/grid/c3_bas3.jpg", "stims/animals/superordinate/grid/c3_sup3.jpg", "stims/vegetables/subordinate/grid/temp_c1_sub6.png", "stims/vegetables/basic/grid/c1_bas4.jpg", "stims/vegetables/superordinate/grid/c1_sup3.jpg", "stims/vehicles/subordinate/grid/c2_sub6.jpg", "stims/vehicles/basic/grid/c2_bas2.jpg", "stims/vehicles/superordinate/grid/c2_sup6.jpg"];
        
        // create empty array that stores the word for each sampling phase image 
        var sampling_image_words = [];

        // shuffle sampling array
        var shuffled_sampling_images = jsPsych.randomization.repeat(sampling_image_names, 1);
        // QUESTION - does randomizing actually need to happen or is it more helpful to have them "in order"?
        // assign names to images in sampling array, with each image receiving the same name on each trial regardless of its index
        for (var i = 0; i < shuffled_sampling_images.length; i++) {
            shuffled_sample_array.push('<img src="'+shuffled_sampling_images[i]+'" width='+grid_image_width+' height='+grid_image_height+'>')
            if (shuffled_sampling_images[i] == "stims/animals/subordinate/grid/c3_sub7.jpg")
               sampling_image_words[i] = "wug";
            else if (shuffled_sampling_images[i] == "stims/animals/basic/grid/c3_bas3.jpg")
                sampling_image_words[i] = "toma";
            else if (shuffled_sampling_images[i] == "stims/animals/superordinate/grid/c3_sup3.jpg")
                sampling_image_words[i] = "dax";
            else if (shuffled_sampling_images[i] == "stims/vegetables/subordinate/grid/temp_c1_sub6.png")
                sampling_image_words[i] = "beppo";
            else if (shuffled_sampling_images[i] == "stims/vegetables/basic/grid/c1_bas4.jpg")
                sampling_image_words[i] = "zeevo";
            else if (shuffled_sampling_images[i] == "stims/vegetables/superordinate/grid/c1_sup3.jpg")
                sampling_image_words[i] = "tesser";
            else if (shuffled_sampling_images[i] == "stims/vehicles/subordinate/grid/c2_sub6.jpg")
                sampling_image_words[i] = "sibu";
            else if (shuffled_sampling_images[i] == "stims/vehicles/basic/grid/c2_bas2.jpg")
                sampling_image_words[i] = "deela";
            else if (shuffled_sampling_images[i] == "stims/vehicles/superordinate/grid/c2_sup6.jpg")
                sampling_image_words[i] = "blicket";
        };
        var shuffled_images = jsPsych.randomization.repeat(grid_image_names, 1);

        // set size of sampling phase images
        for (var i = 0; i < shuffled_images.length; i++) {
            shuffled_grid_array.push('<img src="'+shuffled_images[i]+'" width='+grid_image_width+' height='+grid_image_height+'>')
        }
        
        // organize training images by trial type
        var training_images = {narrow_animal: ["stims/animals/subordinate/training/c3_sub1.jpg", "stims/animals/subordinate/training/c3_sub2.jpg", "stims/animals/subordinate/training/c3_sub3.jpg"], 
                                intermediate_animal: ["stims/animals/basic/training/c3_bas1.jpg", "stims/animals/basic/training/c3_bas2.jpg", "stims/animals/basic/training/c3_bas3.jpg"],
                                broad_animal: ["stims/animals/superordinate/training/c3_sup1.jpg", "stims/animals/superordinate/training/c3_sup2.jpg", "stims/animals/superordinate/training/c3_sup3.jpg"],
                                narrow_vegetable: ["stims/vegetables/subordinate/training/c1_sub1.jpg", "stims/vegetables/subordinate/training/c1_sub2.jpg", "stims/vegetables/subordinate/training/c1_sub3.jpg"],
                                intermediate_vegetable: ["stims/vegetables/basic/training/c1_bas1.jpg", "stims/vegetables/basic/training/c1_bas2.jpg", "stims/vegetables/basic/training/c1_bas3.jpg"],
                                broad_vegetable: ["stims/vegetables/superordinate/training/c1_sup1.jpg", "stims/vegetables/superordinate/training/c1_sup2.jpg", "stims/vegetables/superordinate/training/c1_sup3.jpg"],
                                narrow_vehicle: ["stims/vehicles/subordinate/training/c2_sub1.jpg", "stims/vehicles/subordinate/training/c2_sub2.jpg", "stims/vehicles/subordinate/training/c2_sub3.jpg"],
                                intermediate_vehicle: ["stims/vehicles/basic/training/c2_bas1.jpg", "stims/vehicles/basic/training/c2_bas2.jpg", "stims/vehicles/basic/training/c2_bas3.jpg"],
                                broad_vehicle: ["stims/vehicles/superordinate/training/c2_sup1.jpg", "stims/vehicles/superordinate/training/c2_sup2.jpg", "stims/vehicles/superordinate/training/c2_sup3.jpg"]}

        var training_labels = ["wug", "toma", "dax", "beppo", "zeevo", "tesser", "sibu", "deela", "blicket"] 

        // organize sample images by trial type
        var sample_images = {narrow_animal: ["stims/animals/subordinate/grid/c3_sub7.jpg"], intermediate_animal: ["stims/animals/basic/grid/c3_bas3.jpg"], broad_animal: ["stims/animals/superordinate/grid/c3_sup3.jpg"], 
        narrow_vegetable: ["stims/vegetables/subordinate/grid/temp_c1_sub6.png"], intermediate_vegetable: ["stims/vegetables/basic/grid/c1_bas4.jpg"], broad_vegetable: ["stims/vegetables/superordinate/grid/c1_sup3.jpg"], 
        narrow_vehicle: ["stims/vehicles/subordinate/grid/c2_sub6.jpg"], intermediate_vehicle: ["stims/vehicles/basic/grid/c2_bas2.jpg"], broad_vehicle: ["stims/vehicles/superordinate/grid/c2_sup6.jpg"]}

        // assign correct label to each image
        var sample_items_named = {narrow_animal: {images: [], labels: []}, intermediate_animal: {images: [], labels: []}, broad_animal: {images: [], labels: []},
                            narrow_vegetable: {images: [], labels: []}, intermediate_vegetable: {images: [], labels: []}, broad_vegetable: {images: [], labels: []},
                            narrow_vehicle: {images: [], labels: []}, intermediate_vehicle: {images: [], labels: []}, broad_vehicle: {images: [], labels: []}};
           for (var i = 0; i < 9; i++) {
            sample_items_named[i] = {images: [sample_images[i]], labels: [training_labels[i]]}
            }
        var training_items_named = {narrow_animal: {images: [], labels: []}, intermediate_animal: {images: [], labels: []}, broad_animal: {images: [], labels: []},
                            narrow_vegetable: {images: [], labels: []}, intermediate_vegetable: {images: [], labels: []}, broad_vegetable: {images: [], labels: []},
                            narrow_vehicle: {images: [], labels: []}, intermediate_vehicle: {images: [], labels: []}, broad_vehicle: {images: [], labels: []}};
            // this young lad is very troublesome!                
            for (var i = 0; i < 9; i++) {
                training_items_named[i[0]] = sample_images[i[i]];
                training_items_named[i[1]] = training_labels[i];
                console.log(training_items_named[i[0]]);
            }
            


       // var training_image_names_array = [];
       //var training_image_width = 200;
      //  var training_image_height = 200;

       // var training_image_names = ["stims/animals/subordinate/training/c3_sub1.jpg", "stims/animals/subordinate/training/c3_sub2.jpg", "stims/animals/subordinate/training/c3_sub3.jpg"]

        //^for loop for training images from an array to be able to randomize order(?)
	  
	  trial_set=[
	  	"narrow_animal",
		  "intermediate_animal",
		  "broad_animal",
	  	"narrow_vehicle",
		  "intermediate_vehicle",
		  "broad_vehicle",
	  	"narrow_vegetable",
		  "intermediate_vegetable",
		  "broad_vegetable"
	  ];

	  
	  var shuffled_trial_set = jsPsych.randomization.repeat(trial_set, 1);
	  console.log(shuffled_trial_set);
	  
	  // for (cur_trial_type in shuffled_trial_set) {
		  // var cur_training_items = training_items[cur_trial_type];
		  // var cur_sample_items = sample_items[cur_trial_type];
		  // var cur_test_images = test_images[cur_trial_type];
		  
		  //}
	  
	  
	  var number_trials = 9;
      console.log(number_trials);
	  for (var i = 0; i < number_trials; i++) {

        // empty variables to store response data
        var subject_response ="";
        var number_response ="";

        // display learning trial
        var learning_trial = {
            type: 'html-keyboard-response',
            stimulus: '<p><b><font size="4.5">These are 3 '+training_items_named[i[1]]+'s.</font></b><style="text-align:center;" /p><div class="row"><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub1.jpg" style="width:75%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub2.jpg" style="width:75%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:75%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:50%;opacity:0"></div></div><b><font size="4.5">Press any key to continue.</font></b><style="text-align:center;" /p>',
        }
        console.log(number_trials);
    
    
        // '+(sample_items_named[i])[labels]+'
        timeline.push(learning_trial);

        // display sampling trial
        var sampling_trial = {
            type: 'html-button-response', 
            stimulus: 
            '<p><b><font size="4.5">These are 3 '+training_items_named[i[1]]+'s.</font></b><style="text-align:center;" /p><div class="row"><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub1.jpg" style="width:75%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub2.jpg" style="width:75%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:75%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:50%;opacity:0"></div></div><b><font size="4.5">Your job is to figure out which objects are '+training_items_named[i[1]]+'s and which are not.</font></b><style="text-align:center;" /p> <p><b><font size="4.5">Which of these objects would you like to learn the name of?</font></b><style="text-align:center;" /p><div class="row"><div class="column"></div></div>',
                choices: shuffled_sample_array,
            // log data    
            on_finish: function(data) {
                subject_response = shuffled_sampling_images[data.response];
                number_response = data.response;
                console.log(subject_response);
                console.log(data);
                console.log(number_response);
            }
        }
        timeline.push(sampling_trial);
       

   console.log(subject_response);

   // display test trial
   var test_trial = {
       type: 'html-button-response-catact',
       stimulus: 
           '<p><b><font size="4.5">These are 3 wugs and 1 '+sampling_image_words[number_response]+'.</font></b><style="text-align:center;" /p><div class="row"><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub1.jpg" style="width:50%"></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub2.jpg" style="width:50%"></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:50%"></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:50%;opacity:0"></div></div><p><b><font size="4.5">Your job is to figure out which objects are wugs and which are not.</font></b><style="text-align:center;" /p> <p><b><font size="4.5">Which of these objects would you like to learn the name of?</font></b><style="text-align:center;" /p><div class="row"><div class="column"></div></div>',
       choices: shuffled_grid_array,
       images: shuffled_images,
       response_ends_trial: false,
       on_start: function(trial) {
            trial.stimulus = '<p><b><font size="4.5">The image you selected is a '+sampling_image_words[number_response]+'.</font></b><style="text-align:center;" /p><div class="row"><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub1.jpg" style="width:50%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub2.jpg" style="width:50%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:50%"><figcaption style="font-size:24px">'+training_items_named[i[1]]+'</figcaption></figure></div><div class="column"><figure><img src="'+subject_response+'" style="width:50%"><figcaption style="font-size:24px">'+sampling_image_words[number_response]+'</figcaption></figure></div class="column"></div class="column"></div class="column"></div class="column"><p><b><font size="4.5">Your job is to figure out which objects are '+training_items_named[i[1]]+'s and which are not.</font></b><style="text-align:center;" /p> <p><b><font size="4.5">Now, pick all of the '+training_items_named[i[1]]+'s.</font></b><style="text-align:center;" /p> <p><b><font size="4.5">When you are finished picking, press the submit button at the bottom of the page.</font></b><style="text-align:center;" /p></div><div class="row"><div class="column"></div></div>';
        // else if (sampling_image_words[number_response] == "wug")
           // trial.stimulus = '<p><b><font size="6.5">These are 4 wugs.</font></b><style="text-align:center;" /p><div class="row"><div class="column"><img src="stims/animals/subordinate/training/c3_sub1.jpg" style="width:50%"></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub2.jpg" style="width:50%"></div><div class="column"><img src="stims/animals/subordinate/training/c3_sub3.jpg" style="width:50%"></div><div class="column"><img src="'+subject_response+'" style="width:50%"></div></div> <p><b><font size="6.5">Your job is to figure out which objects are wugs and which are not.</font></b><style="text-align:center;" /p> <p><b><font size="6.5">Now, pick all of the wugs.</font></b><style="text-align:center;" /p><div class="row"><div class="column">';  
            console.log(trial.stimulus)
       }

   }



   timeline.push(test_trial);
      } 


   /*var test_multi_select = {
       type: 'survey-multi-select',
       questions: [
           {
               prompt: "the image you selected is a wug select all the other wugs",
               options: shuffled_grid_array,
           }
       ]
   }
   timeline.push(test_multi_select); */
   
   // initiate timeline, display data on finish
    jsPsych.init({
       timeline: timeline,
       on_finish: function(){jsPsych.data.displayData();jsPsych.data.get().localSave('csv','catAct_test.csv');}
    });

    // make >1 choice at test
    // submit button

    </script>
</html>
